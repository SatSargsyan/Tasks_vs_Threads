# Threads


### Հոսքերի պրիորիտետները
ավելի բարձր պրիորիտետով հոսքը կատարվելու է ավելի շուտ քան ավելի ցածր պրիորիտետովը։ Ընդ որուն, եթե հոսքի կատարման ընթացքում ստեղծվում է ավելի բարձր պրիորիտետով հոսք, ապա ցածր պրիորիտետով հոսքի աշխատանքը անմիջապես ընդհատվում է։
Պրիորիտետը կարելի է **Thread.Priority** հատկանիշի միջոցով։
CLR-ը ընդունում է հոսքի պրիորիտետի հետևյալ արժեքները․

Lowest
BelowNormal
Normal
AboveNormal
Highest

### Ֆոնային և ակտիվ հոսքեր
Ֆոնային (background) կոչվում են այն հոսքերը, որոնք ստիպողաբար ավարտվում են բոլոր ակտիվ (foreground) հոսքերի ավարտման դեպքում։
Հոսքի տիպը կարելի է փոխել IsBackground հատկանիշի միջոցով։
Ծրագրի հիմնական հոսքը, ինչպես նաև Thread դասի միջոցով ստեղծված հոսքերը լռելայն (default) համարվում են ակտիվ (foreground):

### Հոսքերի ավարտի պահի ֆիքսումը
Ստուգել հոսքերի ավարտը կարելի է մի քանի տարբերակով․
Thread.State հատկանիշի միջոցով;
Thread.IsAlive հատկանիշի միջոցով;
Thread․Join ֆունկցիայի միջոցով:
Join ֆունկցիան ստիպում է կանչող հոսքին սպասել մինչև այն հոսքի ավարտը, որի համար կանչվել է ֆունկցիան։ Join-ի գերբեռնումը թույլ է տալիս նշել այն առավելագույն ժամանակը, որի ընթացքում սպասումը կարող է կատարվել։

### Հոսքերի սինքրոնացումը
Հոսքերի սինքրոնացում է կոչվում մեկից ավել հոսքերի աշխատանքի կոորդինացումը։ Սինքրոնացման անհրաժեշտություն առաջանում է հետևյալ դեպքերում․
մի քանի հոսքեր աշխատում են միևնույն ռեսուրսի հետ;
հոսքերից մեկը կամ մի քանիսը սպասում են այլ հոսքից կամ հոսքերից ստացվող ինֆորմացիայի(հիմնականում event-ի տեսքով)։

### Հոսքերի սինքրոնացումը lock բանալի բառի օգնությամբ
lock (lockObj){...} կոնստրուկցիայի միջոցով կարելի է սահմանել կոդի հատված, որի կատարման ժամանակ այլ հոսքերի մուտքը դեպի նշված հատված արգելվում է։

Եթե lock օպերատորի մարմնում նշված կոդին “ցանկանում է”  դիմել այլ հոսքը, ապա դիմող հոսքի աշխատանքը կանգնեցվում է, մինչև ապաբլոկավորումը (բլոկավորող կոդի ավարտը)։

lockObj –ը իրենից ներկայացնում է բլոկավորվող կոդի հատվածը պարունակող դասի փակ դաշտ։
### Monitor դասը
Monitor դասում սահմանված են մի շարք ֆունկցիաներ, մասնավորապես սինքրոնիզացիայի հետ աշխատելու համար։
Monitor․Enter(object obj); ֆունկցիան առաջացնում է օբյեկտի բլոկավորում։
Monitor․Exit(object obj); ֆունկցիան հանում է օբյեկտի բլոկավորումը։
Monitor․TryEnter(object obj); ֆունկցիան վերադարձվող արժեքի միջոցով թույլ է տալիս պարզել, հաջողվել է կատարել բլոկավորում թե՝ ոչ։
lock-կոնստրուկցիան իրենից ներկայացնում է Monitor դասի Enter և Exit ֆունկցիաների կանչելու կրճատ տարբերակ։ 




### Mutex
Մյուտեքսը իրենից ներկայացնում է փոխբացառմամբ սինքրոնիզացվող օբյեկտ։ Այսինքն՝ ժամանակի տվյալ պահին մյուտքսը կարող է ստացվել միայն հոսքերից մեկի միջոցով։
Մյուտեքսը իրականացված է System.Threading.Mutex դասի միջոցով։
Mutex.WaitOne() ֆունկցիան ստիպում է կանչող հոսքին սպասել այնքան ժամանակ, մինչև հասանելի դառնա մյուտեքսի այն օբյեկտը, որի համար ֆունկցիան կանչվում է։ Այնուհետև կատարվում է հոսքի աշխատանքի վերականգնում և մյուտեքսի օբյեկտի բլոկավորում։
Mutex.RealeaseMutex() ֆունկցիայի միջոցով կանչող հոսքը ազատում է  իր կողմից բլոկավորված օբյեկտը։

```C#
class Program
    {
        static object objLock = new object();
        private static Mutex mut = new Mutex();

        public static void SomeFunction()
        {
            mut.WaitOne();

            Console.WriteLine("Entering function");
            Thread.Sleep(1000);
            Console.WriteLine("Making some exclusive job");
            Thread.Sleep(1000);
            Console.WriteLine("Leaving function\n\n");

            mut.ReleaseMutex();
        }

        static void Main(string[] args)
        {
            for (int i = 0; i < 5; i++)
            {
                Thread thread = new Thread(SomeFunction);
                thread.Start();
            }
        }
      }
```
